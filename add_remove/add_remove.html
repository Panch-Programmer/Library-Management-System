<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="add_remove.css">
    <script src="add_remove.js" defer></script>
    <title>Add Books</title>
</head>

<body>
    <header>
        <h1>Admin Home</h1>
    </header>
    <main>
        <section class="form">
            <form action="" id="add_form">
                <h2>Library Form</h2>
                Name: <input id="name" type="text" placeholder="Enter book name" required> <br>
                Author: <input id="author" type="text" placeholder="Enter author name" required> <br>
                Publisher: <input id="publisher" type="text" placeholder="Enter publisher name" required> <br>
                Quantity: <input id="quantity" type="number" placeholder="Enter quantity" required><br>
                <button type="button" id="add_button">Add</button>
                <button type="button" id="remove_button">Remove</button>
            </form>
        </section>
        <section class="catalogue">
            <h2>Catalogue</h2>
            <table class="books">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Author</th>
                        <th>Publisher</th>
                        <th>Quantity</th>
                    </tr>
                </thead>
                <tbody id='tableB'>
                </tbody>
            </table>
        </section>
    </main>
    <footer>
        <a href="../adminHome/adminHome.html" id="scroll-down">&lt Back To Previous Page</a>
    </footer>
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
        import { getDatabase, ref, set, get, child, remove } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-database.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        const tableB = document.getElementById('tableB');

        function displayBooks() {
            const booksRef = ref(db, 'user');
            tableB.innerHTML = "";
            get(booksRef).then((snapshot) => {
                if (snapshot.exists()) {
                    const books = snapshot.val();
                    for (const key in books) {
                        const book = books[key];
                        const row = `<tr>
                            <td>${book.name}</td>
                            <td>${book.author}</td>
                            <td>${book.publisher}</td>
                            <td>${book.quantity}</td>
                        </tr>`;
                        tableB.innerHTML += row;
                    }
                }
            });
        }

        // Call the function to display books when the page loads
        displayBooks();

        document.getElementById("add_button").addEventListener('click', function () {
            const name = document.getElementById("name").value;
            const author = document.getElementById("author").value;
            const publisher = document.getElementById("publisher").value;
            const quantity = parseInt(document.getElementById("quantity").value);

            if (!name || !author || !publisher || isNaN(quantity) || quantity <= 0) {
                window.alert("Error!! Please Fill in All the Details and Provide a Valid Quantity.");
            } else {
                set(ref(db, 'user/' + name), {
                    name: name,
                    author: author,
                    publisher: publisher,
                    quantity: quantity
                }).then(() => {
                    alert("Book Added Successfully");
                    displayBooks();
                }).catch((error) => {
                    console.error("Error adding book:", error);
                });
            }
        });

        var removeButton = document.querySelector("#remove_button");
        removeButton.addEventListener('click', function () {
            const name = document.getElementById("name").value;
            const quantityToRemove = parseInt(document.getElementById("quantity").value);

            if (!name || isNaN(quantityToRemove) || quantityToRemove <= 0) {
                window.alert("Please Fill The Book Name and Provide a Valid Quantity.");
            } else {
                const bookRef = ref(db, 'user/' + name);
                get(bookRef).then((snapshot) => {
                    const book = snapshot.val();
                    if (book && book.quantity >= quantityToRemove) {
                        const updatedQuantity = book.quantity - quantityToRemove;
                        if (updatedQuantity === 0) {
                            // Remove the book if quantity is now 0
                            remove(bookRef).then(() => {
                                alert("Book Removed Successfully");
                                displayBooks();
                            }).catch((error) => {
                                console.error("Error removing book:", error);
                            });
                        } else {
                            // Update the quantity
                            set(bookRef, {
                                ...book,
                                quantity: updatedQuantity
                            }).then(() => {
                                alert("Book Updated Successfully");
                                displayBooks();
                            }).catch((error) => {
                                console.error("Error updating book:", error);
                            });
                        }
                    } else {
                        alert("Invalid Quantity or Book Not Found.");
                    }
                }).catch((error) => {
                    console.error("Error getting book:", error);
                });
            }
        });
    </script>
</body>

</html>

